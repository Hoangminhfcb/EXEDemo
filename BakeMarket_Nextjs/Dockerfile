# Stage: Build
FROM node:18-alpine AS builder
WORKDIR /app

# Copy package and install
COPY package*.json ./
RUN npm install

# Copy source code
COPY . .

# Truy·ªÅn bi·∫øn m√¥i tr∆∞·ªùng khi build (NEXT_PUBLIC_API_URL)
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL

# In ra gi√° tr·ªã bi·∫øn ƒë·ªÉ ki·ªÉm tra
RUN echo "üëâ Building with API URL: $NEXT_PUBLIC_API_URL"

# Build Next.js app v·ªõi bi·∫øn m√¥i tr∆∞·ªùng
RUN npm run build

# Stage: Run (ch·∫°y nh·∫π h∆°n)
FROM node:18-alpine AS runner
WORKDIR /app

# Copy node_modules v√† .next t·ª´ builder
COPY --from=builder /app ./

EXPOSE 3000
CMD ["npm", "start"]
